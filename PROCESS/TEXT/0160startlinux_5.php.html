<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>第五章、首次登陆与在线求助<span class="text_head_en"> man page</title><link href="../Styles/style.css" rel="stylesheet" type="text/css" /></head><body> 
 
<!-- 本文的档头部分 --> 
<div style="text-align: center;"> 
    <a href="0160startlinux.php.html"> 
    <span class="text_head0">第五章、首次登陆与在线求助<span class="text_head_en"> man page</span></span></a><br> 
</div> 
    <div style="text-align: right;"> 
        <span class="text_history">最近升级日期：2009/08/17</span> 
    </div> 
<!-- 本文的连结区部分 --> 
<div class="block1"> 
<span class="text_h1"> 
5. <a href="#shutdown_pc">正确的关机方法</a>: <a href="#sync">sync</a>, <a href="#shutdown">shutdown</a>,  
		<a href="#reboot">reboot, halt, poweroff</a>, <a href="#init">init</a><br> 
</span></div>
<!-- 本文的正式部分 --> 
<hr><a name="shutdown_pc"></a><img src="../images/logo.png" alt="大标题的图示" width="35" align="middle" height="34"><span class="text_h1">正确的关机方法</span><br> 
<div class="block1"> 
	<p>OK！大概知道启动的方法，也知道基本的命令操作，而且还已经知道在线查询了，好累呦！ 
	想去休息呢！那么如何关机呢？我想，很多朋友在DOS的年代已经有在玩计算机了！ 
	在当时我们关掉DOS的系统时，常常是直接关掉电源开关，而 
	Windows 在你不爽的时候，按着电源开关四秒也可以关机！但是在Linux则相当的不建议这么做！</p> 
 
	<p>Why？在 Windows (非 NT 主机系统) 系统中，由于是单人假多任务的情况，所以即使你的计算机关机， 
	对于别人应该不会有影响才对！不过呢，在 Linux 底下，由于每个程序 (或者说是服务) 
	都是在在背景下运行的，因此，<span class="text_import2">在你看不到的屏幕背后其实可能有相当多人同时在你的主机上面工作</span>， 
	例如浏览网页啦、传送信件啦以 FTP 传送文件啦等等的，如果你直接按下电源开关来关机时， 
	则其他人的数据可能就此中断！那可就伤脑筋了！</p> 
 
	<p>此外，最大的问题是，<span class="text_import2">若不正常关机，则可能造成文件系统的毁损</span> 
	（因为来不及将数据回写到文件中，所以有些服务的文件会有问题！）。所以正常情况下，要关机时需要注意底下几件事：</p> 
 
	<ul> 
	<li><span class="text_import1">观察系统的使用状态</span>：<br> 
		如果要看目前有谁在在线，可以下达『who』这个命令，而如果要看网络的联机状态，可以下达 
		『 netstat -a 』这个命令，而要看背景运行的程序可以运行『 
		ps -aux 』这个命令。使用这些命令可以让你稍微了解主机目前的使用状态！当然啰，就可以让你判断是否可以关机了 
		（这些命令在后面Linux常用命令中会提及喔！）<br><br></li> 
 
	<li><span class="text_import1">通知在线使用者关机的时刻</span>：<br> 
		要关机前总得给在线的使用者一些时间来结束他们的工作，所以，这个时候你可以使用 
		shutdown 的特别命令来达到此一功能。<br><br></li> 
 
	<li><span class="text_import1">正确的关机命令使用</span>：<br>例如 shutdown 与 reboot 两个命令！</li> 
	</ul> 
 
	<p>所以底下我们就来谈一谈几个与关机/重新启动相关的命令啰！</p> 
 
	<ul> 
	<li>将数据同步写入硬盘中的命令： sync</li> 
	<li>惯用的关机命令： shutdown</li> 
	<li>重新启动，关机： reboot, halt, poweroff</li> 
	</ul> 
	<div style="padding: 10pt 0pt;" align="right"><table width="90%"><tbody><tr><td><b>Tips:</b><br><span style="color: rgb(0, 144, 0);"><font size="-1">	由于Linux系统的关机/重新启动是很重大的系统运行，因此只有root才能够进行例如shutdown, reboot等命令。 
	不过在某些distributions当中，例如我们这里谈到的CentOS系统，他允许你在本机前的tty7使用图形接口登陆时， 
	可以用一般账号来关机或重新启动！但某些distributions则在你要关机时，他会要你输入root的密码呢！^_^ 
	</font></span></td><td><img src="0160startlinux_files/vbird_face.gif" alt="鸟哥的图示" title="鸟哥的图示"></td></tr></tbody></table></div> 
	<a name="sync"></a> 
	<hr><a name="sync"></a><img src="../images/logo.png" alt="小标题的图示" width="24" align="middle" height="23"><span class="text_h2">数据同步写入磁盘： sync</span><br> 
	<div class="block2"> 
		<p>在<a href="0105computers.php.html">第零章、计算器概论</a>里面我们谈到过数据在计算机中运行的模式， 
		所有的数据都得要被读入内存后才能够被CPU所处理，但是数据又常常需要由内存写回硬盘当中(例如储存的动作)。 
		由于硬盘的速度太慢(相对于内存来说)，如果常常让数据在内存与硬盘中来回写入/读出，系统的效能就不会太好。</p> 
 
		<p>因此在Linux系统中，为了加快数据的读取速度，所以在默认的情况中， 
		某些已经加载内存中的数据将不会直接被写回硬盘，而是先缓存在内存当中，如此一来， 
		如果一个数据被你重复的改写，那么由于他尚未被写入硬盘中，因此可以直接由内存当中读取出来， 
		在速度上一定是快上相当多的！</p> 
 
		<p>不过，如此一来也造成些许的困扰，那就是万一你的系统因为某些特殊情况造成不正常关机 
		(例如停电或者是不小心踢到power)时，由于数据尚未被写入硬盘当中，哇！所以就会造成数据的升级不正常啦！ 
		那要怎么办呢？这个时候就需要sync这个命令来进行数据的写入动作啦！ 
		直接在文字接口下输入sync，那么在内存中尚未被升级的数据，就会被写入硬盘中！所以，这个命令在系统关机或重新启动之前， 
		很重要喔！最好多运行几次！</p> 
 
		<p>虽然目前的 shutdown/reboot/halt 等等命令均已经在关机前进行了 sync 这个工具的呼叫， 
		不过，多做几次总是比较放心点～呵呵～</p> 
 
<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">sync</span> 
</pre></td></tr></tbody></table> 
 
		<div style="padding: 10pt 0pt;" align="right"><table width="90%"><tbody><tr><td><b>Tips:</b><br><span style="color: rgb(0, 144, 0);"><font size="-1">		事实上sync也可以被一般账号使用喔！只不过一般账号用户所升级的硬盘数据就仅有自己的数据， 
		不像root可以升级整个系统中的数据了。 
		</font></span></td><td><img src="0160startlinux_files/vbird_face.gif" alt="鸟哥的图示" title="鸟哥的图示"></td></tr></tbody></table></div>	</div> 
 
	<a name="shutdown"></a> 
	<hr><img src="../images/logo.png" alt="小标题的图示" width="24" align="middle" height="23"><span class="text_h2">惯用的关机命令： shutdown</span><br> 
	<div class="block2"> 
		<p>由于Linux的关机是那么重要的工作，因此除了你是在主机前面以tty7图形接口来登陆系统时， 
		不论用什么身份都能够关机之外，若你是使用远程管理工具(如透过pietty使用ssh服务来从其他计算机登陆主机)， 
		那关机<span class="text_import2">就只有root有权力而已喔！</span></p> 
 
		<p>嗯！那么就来关机试试看吧！我们较常使用的是shutdown这个命令，而这个命令会通知系统内的各个程序 
		(processes)，并且将通知系统中的run-level内的一些服务来关闭。shutdown可以达成如下的工作：</p> 
 
		<ul class="text_import2"> 
		<li>可以自由选择关机模式：是要关机、重新启动或进入单人操作模式均可；</li> 
		<li>可以配置关机时间: 可以配置成现在立刻关机, 也可以配置某一个特定的时间才关机。</li> 
		<li>可以自定义关机信息：在关机之前，可以将自己配置的信息传送给在线 user 。</li> 
		<li>可以仅发出警告信息：有时有可能你要进行一些测试，而不想让其他的使用者干扰， 
			或者是明白的告诉使用者某段时间要注意一下！这个时候可以使用 
			shutdown 来吓一吓使用者，但却不是真的要关机啦！</li> 
		<li>可以选择是否要 fsck 检查文件系统 。</li> 
		</ul> 
 
		<p>那么shutdown的语法是如何呢？聪明的读者大概已经开始找『男人』了！没错，随时随地的 
		man 一下，是很不错的举动！好了，简单的语法守则为：</p> 
 
<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">/sbin/shutdown [-t 秒] [-arkhncfF] 时间 [警告信息]</span> 
<span class="term_say">选项与参数： 
-t sec ： -t 后面加秒数，亦即『过几秒后关机』的意思 
-k     ： 不要真的关机，只是发送警告信息出去！ 
-r     ： 在将系统的服务停掉之后就重新启动(常用) 
-h     ： 将系统的服务停掉后，立即关机。 (常用) 
-n     ： 不经过 init 程序，直接以 shutdown 的功能来关机 
-f     ： 关机并启动之后，强制略过 fsck 的磁盘检查 
-F     ： 系统重新启动之后，强制进行 fsck 的磁盘检查 
-c     ： 取消已经在进行的 shutdown 命令内容。 
时间   ： 这是一定要加入的参数！指定系统关机的时间！时间的范例底下会说明。 
范例：</span> 
[root@www ~]# <span class="term_command">/sbin/shutdown -h 10 'I will shutdown after 10 mins'</span> 
<span class="term_say"># 告诉大家，这部机器会在十分钟后关机！并且会显示在目前登陆者的屏幕前方！ 
# 至于参数有哪些呢？以下介绍几个吧！</span> 
</pre></td></tr></tbody></table> 
 
		<p>此外，需要注意的是，<span class="text_import2">时间参数请务必加入命令中，否则shutdown会自动跳到 
		run-level 1 (就是单人维护的登陆情况)</span>，这样就伤脑筋了！底下提供几个时间参数的例子吧：</p> 
 
<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">shutdown -h now</span> 
<span class="term_say">立刻关机，其中 now 相当于时间为 0 的状态</span> 
[root@www ~]# <span class="term_command">shutdown -h 20:25</span> 
<span class="term_say">系统在今天的 20:25 分会关机，若在21:25才下达此命令，则隔天才关机</span> 
[root@www ~]# <span class="term_command">shutdown -h +10</span> 
<span class="term_say">系统再过十分钟后自动关机</span> 
[root@www ~]# <span class="term_command">shutdown -r now</span> 
<span class="term_say">系统立刻重新启动</span> 
[root@www ~]# <span class="term_command">shutdown -r +30 'The system will reboot' </span> 
<span class="term_say">再过三十分钟系统会重新启动，并显示后面的信息给所有在在线的使用者</span> 
[root@www ~]# <span class="term_command">shutdown -k now 'This system will reboot' </span> 
<span class="term_say">仅发出警告信件的参数！系统并不会关机啦！吓唬人！</span> 
</pre></td></tr></tbody></table> 
	</div> 
 
	<a name="reboot"></a> 
	<hr><img src="../images/logo.png" alt="小标题的图示" width="24" align="middle" height="23"><span class="text_h2">重新启动，关机： reboot, halt, poweroff</span><br> 
	<div class="block2"> 
		<p>还有三个命令可以进行重新启动与关机的任务，那就是reboot, halt, poweroff。 
		其实这三个命令呼叫的函式库都差不多，所以当你使用『man reboot』时，会同时出现三个命令的用法给你看呢。 
		其实鸟哥通常都只有记shutdown与reboot这两个命令啦！不过使用poweroff这个命令却比较简单就是了！^_^ 
		通常鸟哥在重新启动时，都会下达如下的命令喔：</p> 
 
<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">sync; sync; sync; reboot</span> 
</pre></td></tr></tbody></table> 
 
		<p>既然这些命令都能够关机或重新启动，那他有没有什么差异啊？基本上，在默认的情况下， 
		这几个命令都会完成一样的工作！(因为halt会先呼叫shutdown，而shutdown最后会呼叫halt！)。 
		不过，shutdown可以依据目前已启动的服务来逐次关闭各服务后才关机；至于halt却能够在不理会目前系统状况下， 
		进行硬件关机的特殊功能！你可以在你的主机上面使用root进行底下两个命令来关机，比较看看差异在哪里喔！</p> 
 
<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">shutdown -h now</span> 
[root@www ~]# <span class="term_command">poweroff -f</span> 
</pre></td></tr></tbody></table> 
 
		<p>更多halt与poweroff的选项功能，请务必使用man去查询一下喔！</p> 
	</div> 
 
	<a name="init"></a> 
	<hr><img src="../images/logo.png" alt="小标题的图示" width="24" align="middle" height="23"><span class="text_h2">切换运行等级： init</span><br> 
	<div class="block2"> 
		<p>本章上头有谈到过关于run level的问题。之前谈到的是系统运行的模式，分为纯文本(run level  
		3)及图形接口模式(run level 5)。除了这两种模式外，有没有其他模式呢？其实Linux共有七种运行等级， 
		七种等级的意义我们在后面会再谈到。本章你只要知道底下四种运行等级就好了：</p> 
		<ul class="text_import2"> 
		<li>run level 0：关机</li> 
		<li>run level 3：纯文本模式</li> 
		<li>run level 5：含有图形接口模式</li> 
		<li>run level 6：重新启动</li> 
		</ul> 
 
		<p>那如何切换各模式呢？可以使用init这个命令来处理喔！也就是说，如果你想要关机的话， 
		除了上述的shutdown -h now以及poweroff之外，你也可以使用如下的命令来关机：</p> 
 
<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">init 0</span> 
</pre></td></tr></tbody></table> 
	</div> 
</div> 
<hr />
    </td>
    <td style="width: 16px; font-size: 6px;">　</td></tr>
<tr><td style="width: 16px; height: 16px;">　</td>
    <td style="width: 866px; height: 16px;">　</td>
    <td style="width: 16px; height: 16px;">　</body></html>