<html><head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="Author" content="2011/04/28,lee">
	<meta name="Description" content="ç™»å½•æ–‡ä»¶çš„åˆ†æå•¦ï¼">
	<title>é¸Ÿå“¥çš„ Linux ç§æˆ¿èœ -- ç™»å½•æ–‡ä»¶çš„åˆ†æå•¦ï¼</title>
    <script src="../script/SpryMenuBar.js" type="text/javascript"></script>
	<script src="../script/index.js" type="text/javascript"></script>
	<link href="../css/SpryMenuBarHorizontal.css" rel="stylesheet" type="text/css" />
    <link href="../css/main.css" rel="stylesheet" type="text/css" />
    </head><body style="margin: 0pt; padding: 0pt;" class="table"onload="MM_preloadImages('image/title_19.png','image/title_26.png','image/title_27.png','image/title_28.png','image/title_06.png','image/title_08.png','image/title_10.png','image/title_12.png')">


<!-- Copyright © 2005. Spidersoft Ltd -->
<style>
A.applink:hover {border: 2px dotted #DCE6F4;padding:2px;background-color:#ffff00;color:green;text-decoration:none}
A.applink       {border: 2px dotted #DCE6F4;padding:2px;color:#2F5BFF;background:transparent;text-decoration:none}
A.info          {color:#2F5BFF;background:transparent;text-decoration:none}
A.info:hover    {color:green;background:transparent;text-decoration:underline}
</style>
<div style='BORDER: 1px solid #DCE6F4; MARGIN-TOP: 20px; MARGIN-BOTTOM: 20px; MARGIN-LEFT: 5px; MARGIN-RIGHT: 5px; PADDING: 5px; BACKGROUND-COLOR: #eef8ff;line-height:180%; COLOR: #000000; font-family: Arial; font-size: 8pt; width=100%; FILTER: progid:DXImageTransform.Microsoft.Gradient(GradientType=0, StartColorStr="#FFFFFFFF", EndColorStr="#F2F5FAFF");'>
This page was saved using <a class="applink" href="http://www.spidersoft.com"><b>WebZIP 7.0.3.1030</b></a> <a class="applink" href="http://www.spidersoft.com"><b>offline browser</b></a>  (Unregistered) on  02/12/15 12:14:49.<br>
<b>Address:</b> <a class="info" href="http://vbird.dic.ksu.edu.tw/linux_basic/0570syslog_3.php">http://vbird.dic.ksu.edu.tw/linux_basic/0570syslog_3.php</a><br>
<b>Title:</b> é¸Ÿå“¥çš„ Linux ç§æˆ¿èœ -- ç™»å½•æ–‡ä»¶çš„åˆ†æå•¦ï¼ &nbsp;&bull;&nbsp; <b>Size:</b> 31207<br></div>
<!-- /Copyright © 2005. Spidersoft Ltd -->



<center>
<div id="apDiv5">
<div> <LINK REL="SHORTCUT ICON" HREF="favicon.ico">
<!-- ImageReady Slices (title3.ai) -->
<table id="___01" width="898" height="81" border="0" align="center" cellpadding="0" cellspacing="0";>
	<tr>
		<td colspan="15">
			<img src="image/title/title_01.png" width="900" height="1" alt=""></td>
	</tr>
	<tr>
		<td rowspan="4" bgcolor="#182448"><p><img src="http://linux.vbird.org/cgi-bin/Count.cgi?dd=C&ft=5&sh=T&md=8&pad=Y&df=vbird.dic.ksu.edu.tw.dat" width="93" align="left" title="è¨ˆæ•¸å™¨" /></p>
	    <p><font color="#FFFFFF" size="-1">since2012/04/23</font></p></td>
		<td rowspan="4" align="left" valign="top"><a href="http://vbird.dic.ksu.edu.tw/"><img src="image/title/title_03.png" alt="" width="263" height="79" border="0"></a></td>
		<td colspan="13">
			<img src="image/title/title_04.png" alt="" width="535" height="9" border="0"></td>
	</tr>
	<tr>
		<td rowspan="3">
			<img src="image/title/title_05.png" alt="" width="53" height="70" border="0"></td>
		<td colspan="2" align="left" valign="top"><a href="0110whatislinux.php.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image51','','image/title/title_06.png',1)"><img src="image/title/title3_06.png" name="Image51" width="106" height="25" border="0" id="Image51" alt=""/></a></td>
		<td rowspan="2">
			<img src="image/title/title_07.png" alt="" width="27" height="37" border="0"></td>
		<td colspan="3" align="left" valign="top"><a href="http://vbird.dic.ksu.edu.tw/linux_server/0110network_basic.php" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image52','','image/title/title_08.png',1)"><img src="image/title/title3_08.png" name="Image52" width="107" height="25" border="0" id="Image52" alt=""/></a></td>
		<td rowspan="2">
			<img src="image/title/title_09.png" alt="" width="37" height="37" border="0"></td>
		<td colspan="2" align="left" valign="top"><a href="http://vbird.dic.ksu.edu.tw/about.php" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image53','','image/title/title_10.png',1)"><img src="image/title/title3_10.png" name="Image53" width="75" height="25" border="0" id="Image53" alt=""/></a></td>
		<td rowspan="3">
			<img src="image/title/title_11.png" alt="" width="35" height="70" border="0"></td>
		<td align="left" valign="top"><a href="mailto:vbird@mail.vbird.idv.tw" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image54','','image/title/title_12.png',1)"><img src="image/title/title3_12.png" name="Image54" width="74" height="25" border="0" id="Image54" alt=""/></a></td>
		<td rowspan="3">
			<img src="image/title/title_13.png" alt="" width="21" height="70" border="0"></td>
	</tr>
	<tr>
		<td colspan="2">
			<img src="image/title/title_14.png" alt="" width="106" height="12" border="0"></td>
		<td colspan="3">
			<img src="image/title/title_15.png" alt="" width="107" height="12" border="0"></td>
		<td colspan="2">
			<img src="image/title/title_16.png" width="75" height="12" alt=""></td>
		<td rowspan="2">
			<img src="image/title/title_17.png" alt="" width="74" height="45" border="0"></td>
	</tr>
	<tr>
		<td>
			<img src="image/title/title_18.png" alt="" width="15" height="33" border="0"></td>
		<td colspan="3" align="left" valign="top"><ul id="MenuBar1" class="MenuBarHorizontal">
	  <li><a href="linux_basic.php.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image44','','image/title/title_19.png',1)"><img src="image/title/title3_19.png" name="Image44" width="123" height="33" border="0" id="Image44" /></a>
			    <ul>
			      <li><a href="Mandrake9.0/mandrake9.0.php.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image46','','image/title/title_26.png',1)"><img src="image/title/title_23.png" name="Image46" width="120" height="26" border="0" id="Image46" alt="" /></a></li>
                  <li><a href="fedora_4/fc4.php.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image47','','image/title/title_27.png',1)"><img src="image/title/title_24.png" name="Image47" width="120" height="26" border="0" id="Image47" alt="" /></a></li>
                  <li><a href="linux_basic.php.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image48','','image/title/title_28.png',1)"><img src="image/title/title_25.png" name="Image48" width="120" height="26" border="0" id="Image48" alt="" /></a></li>
                </ul>
		      </li>
		</ul></td>
		<td>
			<img src="image/title/title_20.png" alt="" width="42" height="33" border="0"></td>
		<td colspan="3" align="left" valign="top"><ul id="MenuBar2" class="MenuBarHorizontal">
	  <li><a href="http://vbird.dic.ksu.edu.tw/linux_server/" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image45','','image/title/title_21.png',1)"><img src="image/title/title3_21.png" name="Image45" width="125" height="33" border="0" id="Image45" /></a>
			    <ul>
			      <li><a href="http://vbird.dic.ksu.edu.tw/linux_server/linux_redhat9/redhat9.php" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image43','','image/title/title_26.png',1)"><img src="image/title/title_23.png" name="Image43" width="120" height="26" border="0" id="Image43" alt=""/></a></li>
			      <li><a href="http://vbird.dic.ksu.edu.tw/linux_server/centos4.php" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image49','','image/title/title_27.png',1)"><img src="image/title/title_24.png" name="Image49" width="120" height="26" border="0" id="Image49" alt="" /></a></li>
			      <li><a href="http://vbird.dic.ksu.edu.tw/linux_server/" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image50','','image/title/title_28.png',1)"><img src="image/title/title_25.png" name="Image50" width="120" height="26" border="0" id="Image50" alt="" /></a></li>
		        </ul>
		      </li>
		</ul></td>
		<td>
			<img src="image/title/title_22.png" alt="" width="47" height="33" border="0"></td>
	</tr>
	<tr>
		<td>
			<img src="image/title/Spacer.gif" width="101" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="263" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="53" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="15" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="91" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="27" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="5" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="42" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="60" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="37" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="28" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="47" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="35" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="74" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="22" height="1" alt=""></td>
	</tr>
</table>
<!-- End ImageReady Slices -->
<script type="text/javascript">
<!--
var MenuBar1 = new Spry.Widget.MenuBar("MenuBar1", {imgDown:"SpryAssets/SpryMenuBarDownHover.gif", imgRight:"SpryAssets/SpryMenuBarRightHover.gif"});
var MenuBar2 = new Spry.Widget.MenuBar("MenuBar2", {imgDown:"SpryAssets/SpryMenuBarDownHover.gif", imgRight:"SpryAssets/SpryMenuBarRightHover.gif"});
//-->
</script></div>
<table summary="æœ¬æ–‡å†…å®¹çš„æ’ç‰ˆ" style="width: 898px;" border="0" cellpadding="0" cellspacing="0">
<tbody><tr><td style="width: 16px; height: 16px;">ã€€</td>
    <td style="width: 866px; height: 16px;">ã€€</td>
    <td style="width: 16px; height: 16px;">ã€€</td></tr>
<tr><td style="width: 16px; font-size: 6px;">ã€€</td>
    <td width="866">

<!-- æœ¬æ–‡çš„æ¡£å¤´éƒ¨åˆ† -->
<div style="text-align: center;">
    <a href="0570syslog.php.html">
    <span class="text_head0">ç¬¬åä¹ç« ã€è®¤è¯†ä¸åˆ†æç™»å½•æ–‡ä»¶</span></a><br>
</div>
    <div style="text-align: right;">
        <span class="text_history">æœ€è¿‘å‡çº§æ—¥æœŸï¼š2009/09/14</span>
    </div>
<!-- æœ¬æ–‡çš„è¿ç»“åŒºéƒ¨åˆ† -->
<div class="block1">
<span class="text_h1">
3. <a href="#rotate">ç™»å½•æ–‡ä»¶çš„è½®æ›¿ (logrotate)</a><br>
	<span class="text_h2">
	ã€€ã€€3.1 <a href="#rotate_config">logrotate çš„é…ç½®æ¡£</a><br>
	ã€€ã€€3.2 <a href="#rotate_command">å®é™…æµ‹è¯• logrotate çš„åŠ¨ä½œ</a><br>
	ã€€ã€€3.3 <a href="#rotate_user">è‡ªè®¢ç™»å½•æ–‡ä»¶çš„è½®æ›¿åŠŸèƒ½</a><br>
	</span>
</span></div>
<!-- æœ¬æ–‡çš„æ­£å¼éƒ¨åˆ† -->
<hr><a name="rotate"></a><img src="../image/logo.png" alt="å¤§æ ‡é¢˜çš„å›¾ç¤º" width="35" align="middle" height="34"><span class="text_h1">ç™»å½•æ–‡ä»¶çš„è½®æ›¿(logrotate)</span><br>
<div class="block1">
	<p>å‡è®¾æˆ‘ä»¬å·²ç»å°†ç™»å½•æ•°æ®å†™å…¥äº†è®°å½•æ¡£ä¸­äº†ï¼Œä¹Ÿå·²ç»åˆ©ç”¨ chattr é…ç½®äº† +a è¿™ä¸ªå±æ€§äº†ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•è¿›è¡Œ
	logrotate çš„å·¥ä½œå‘¢ï¼Ÿè¿™é‡Œè¯·ç‰¹åˆ«ç•™æ„çš„æ˜¯ï¼šã€<span class="text_import2">syslog åˆ©ç”¨çš„æ˜¯ daemon çš„æ–¹å¼æ¥å¯åŠ¨çš„ï¼Œ
	å½“æœ‰éœ€æ±‚çš„æ—¶å€™ç«‹åˆ»å°±ä¼šè¢«è¿è¡Œçš„ï¼Œä½†æ˜¯ logrotate å´æ˜¯åœ¨è§„å®šçš„æ—¶é—´åˆ°äº†ä¹‹åæ‰æ¥è¿›è¡Œç™»å½•æ–‡ä»¶çš„è½®æ›¿ï¼Œ
	æ‰€ä»¥è¿™ä¸ª logrotate ç¨‹åºå½“ç„¶å°±æ˜¯æŒ‚åœ¨ <a href="0430cron.php.html">cron</a> åº•ä¸‹è¿›è¡Œçš„å‘¦ï¼</span>ã€
	ä»”ç»†çœ‹ä¸€ä¸‹ /etc/cron.daily/ é‡Œé¢çš„æ–‡ä»¶ï¼Œå˜¿å˜¿ï½çœ‹åˆ°äº†å§ï¼ /etc/cron.daily/logrotate 
	å°±æ˜¯è®°å½•äº†æ¯å¤©è¦è¿›è¡Œçš„ç™»å½•æ–‡ä»¶è½®æ›¿çš„è¡Œä¸ºå•¦ï¼ ^_^ï¼åº•ä¸‹æˆ‘ä»¬å°±æ¥è°ˆä¸€è°ˆæ€ä¹ˆæ ·è®¾è®¡è¿™ä¸ª logrotate å§ï¼<br><br></p>

	<hr><a name="rotate_config"></a><img src="../image/logo.png" alt="å°æ ‡é¢˜çš„å›¾ç¤º" width="24" align="middle" height="23"><span class="text_h2">logrotate çš„é…ç½®æ¡£</span><br>
	<div class="block2">
		<p>æ—¢ç„¶ logrotate ä¸»è¦æ˜¯é’ˆå¯¹ç™»å½•æ–‡ä»¶æ¥è¿›è¡Œè½®æ›¿çš„åŠ¨ä½œï¼Œæ‰€ä»¥ç½—ï¼Œä»–å½“ç„¶å¿…é¡»è¦è®°è½½ã€
		åœ¨ä»€ä¹ˆçŠ¶æ€ä¸‹æ‰å°†ç™»å½•æ–‡ä»¶è¿›è¡Œè½®æ›¿ã€çš„é…ç½®å•Šï¼é‚£ä¹ˆ logrotate è¿™ä¸ªç¨‹åºçš„å‚æ•°é…ç½®æ¡£åœ¨å“ªé‡Œå‘¢ï¼Ÿå‘µå‘µï¼é‚£å°±æ˜¯ï¼š</p>

		<ul class="text_import2" style="font-family: 'ç»†æ˜ä½“';">
		<li>/etc/logrotate.conf</li>
		<li>/etc/logrotate.d/</li>
		</ul>

		<p>é‚£ä¸ª logrotate.conf æ‰æ˜¯ä¸»è¦çš„å‚æ•°æ–‡ä»¶ï¼Œè‡³æ–¼ logrotate.d æ˜¯ä¸€ä¸ªç›®å½•ï¼Œ
		è¯¥ç›®å½•é‡Œé¢çš„æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šè¢«ä¸»åŠ¨çš„è¯»å…¥ /etc/logrotate.conf å½“ä¸­æ¥è¿›è¡Œï¼å¦å¤–ï¼Œåœ¨
		/etc/logrotate.d/ é‡Œé¢çš„æ–‡ä»¶ä¸­ï¼Œå¦‚æœæ²¡æœ‰è§„å®šåˆ°çš„ä¸€äº›ç»†éƒ¨é…ç½®ï¼Œåˆ™ä»¥ /etc/logrotate.conf
		è¿™ä¸ªæ–‡ä»¶çš„è§„å®šæ¥æŒ‡å®šä¸ºé»˜è®¤å€¼ï¼</p>

		<p>å¥½äº†ï¼Œåˆšåˆšæˆ‘ä»¬æåˆ° logrotate çš„ä¸»è¦åŠŸèƒ½å°±æ˜¯å°†æ—§çš„ç™»å½•æ–‡ä»¶ç§»åŠ¨æˆæ—§æ¡£ï¼Œ
		å¹¶ä¸”é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºçš„æ–‡ä»¶æ¥è®°å½•ï¼Œä»–çš„è¿è¡Œç»“æœæœ‰ç‚¹ç±»ä¼¼åº•ä¸‹çš„å›¾ç¤ºï¼š</p>

		<center><img src="0570syslog_files/logrotate.gif" alt="ç™»å½•æ–‡ä»¶è¿›è¡Œ logrotate çš„ç»“æœ" title="ç™»å½•æ–‡ä»¶è¿›è¡Œ logrotate çš„ç»“æœ" border="0"><br>
		å›¾ 3.1.1ã€ ç™»å½•æ–‡ä»¶è¿›è¡Œ logrotate çš„ç»“æœ<br></center>

		<p>ç”±ä¸Šé¢çš„å›¾ç¤ºæˆ‘ä»¬å¯ä»¥æ¸…æ¥šçš„çŸ¥é“ï¼Œå½“ç¬¬ä¸€æ¬¡è¿è¡Œå®Œ rotate ä¹‹åï¼ŒåŸæœ¬çš„ messages ä¼šå˜æˆ messages.1
		è€Œä¸”ä¼šåˆ¶é€ ä¸€ä¸ªç©ºçš„ messages ç»™ç³»ç»Ÿæ¥å‚¨å­˜ç™»å½•æ–‡ä»¶ã€‚è€Œç¬¬äºŒæ¬¡è¿è¡Œä¹‹åï¼Œåˆ™ messages.1 ä¼šå˜æˆ
		messages.2 è€Œ messages ä¼šå˜æˆ messages.1 ï¼Œåˆé€ æˆä¸€ä¸ªç©ºçš„ messages 
		æ¥å‚¨å­˜ç™»å½•æ–‡ä»¶ï¼é‚£ä¹ˆå¦‚æœæˆ‘ä»¬ä»…é…ç½®ä¿ç•™ä¸‰ä¸ªç™»å½•æ–‡ä»¶è€Œå·²çš„è¯ï¼Œé‚£ä¹ˆè¿è¡Œç¬¬å››æ¬¡æ—¶ï¼Œåˆ™
		messages.3 è¿™ä¸ªæ–‡ä»¶å°±ä¼šè¢«åˆ é™¤ï¼Œå¹¶ç”±åé¢çš„è¾ƒæ–°çš„ä¿å­˜ç™»å½•æ–‡ä»¶æ‰€å–ä»£ï¼åŸºæœ¬çš„å·¥ä½œå°±æ˜¯è¿™æ ·å•¦ï¼</p>

		<p>é‚£ä¹ˆå¤šä¹…è¿›è¡Œä¸€æ¬¡è¿™æ ·çš„ logrotate å·¥ä½œå‘¢ï¼Ÿè¿™äº›éƒ½è®°å½•åœ¨ logrotate.conf	é‡Œé¢ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹é»˜è®¤çš„ 
		logrotate çš„å†…å®¹å§ï¼</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">vim /etc/logrotate.conf</span>
<span class="term_say"># åº•ä¸‹çš„é…ç½®æ˜¯ "logrotate çš„é»˜è®¤é…ç½®å€¼" ï¼Œå¦‚æœä¸ªåˆ«çš„æ–‡ä»¶é…ç½®äº†å…¶ä»–çš„å‚æ•°ï¼Œ
# åˆ™å°†ä»¥ä¸ªåˆ«çš„æ–‡ä»¶é…ç½®ä¸ºä¸»ï¼Œè‹¥è¯¥æ–‡ä»¶æ²¡æœ‰é…ç½®åˆ°çš„å‚æ•°åˆ™ä»¥è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ä¸ºé»˜è®¤å€¼ï¼</span>

<span class="term_write">weekly    <span class="term_note">&lt;==é»˜è®¤æ¯ä¸ªç¤¼æ‹œå¯¹ç™»å½•æ–‡ä»¶è¿›è¡Œä¸€æ¬¡ rotate çš„å·¥ä½œ</span>
rotate 4  <span class="term_note">&lt;==ä¿ç•™å‡ ä¸ªç™»å½•æ–‡ä»¶å‘¢ï¼Ÿé»˜è®¤æ˜¯ä¿ç•™å››ä¸ªï¼</span>
create    <span class="term_note">&lt;==ç”±æ–¼ç™»å½•æ–‡ä»¶è¢«æ›´åï¼Œå› æ­¤åˆ›å»ºä¸€ä¸ªæ–°çš„æ¥ç»§ç»­å‚¨å­˜ä¹‹æ„ï¼</span>
#compress <span class="term_note">&lt;==è¢«æ›´åŠ¨çš„ç™»å½•æ–‡ä»¶æ˜¯å¦éœ€è¦å‹ç¼©ï¼Ÿå¦‚æœç™»å½•æ–‡ä»¶å¤ªå¤§åˆ™å¯è€ƒè™‘æ­¤å‚æ•°å¯åŠ¨</span>

include /etc/logrotate.d
<span class="term_say"># å°† /etc/logrotate.d/ è¿™ä¸ªç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶éƒ½è¯»è¿›æ¥è¿è¡Œ rotate çš„å·¥ä½œï¼</span>

/var/log/wtmp {       <span class="term_note">&lt;==ä»…é’ˆå¯¹ /var/log/wtmp æ‰€é…ç½®çš„å‚æ•°</span>
    monthly           <span class="term_note">&lt;==æ¯ä¸ªæœˆä¸€æ¬¡ï¼Œå–ä»£æ¯å‘¨ï¼</span>
    minsize 1M        <span class="term_note">&lt;==æ–‡ä»¶å®¹é‡ä¸€å®šè¦è¶…è¿‡ 1M åæ‰è¿›è¡Œ rotate (ç•¥è¿‡æ—¶é—´å‚æ•°)</span>
    create 0664 root utmp <span class="term_note">&lt;==æŒ‡å®šæ–°å»ºæ–‡ä»¶çš„æƒé™ä¸æ‰€å±å¸å·/ç¾¤ç»„</span>
    rotate 1          <span class="term_note">&lt;==ä»…ä¿ç•™ä¸€ä¸ªï¼Œäº¦å³ä»…æœ‰ wtmp.1 ä¿ç•™è€Œå·²ã€‚</span>
}</span>
<span class="term_say"># è¿™ä¸ª wtmp å¯è®°å½•ç™»é™†è€…ä¸ç³»ç»Ÿé‡æ–°å¯åŠ¨æ—¶çš„æ—¶é—´ä¸æ¥æºä¸»æœºåŠç™»é™†æœŸé—´çš„æ—¶é—´ã€‚
# ç”±æ–¼å…·æœ‰ minsize çš„å‚æ•°ï¼Œå› æ­¤ä¸è§å¾—æ¯ä¸ªæœˆä¸€å®šä¼šè¿›è¡Œä¸€æ¬¡å–”ï¼è¦çœ‹æ–‡ä»¶å®¹é‡ã€‚
# ç”±æ–¼ä»…ä¿ç•™ä¸€ä¸ªç™»å½•æ–‡ä»¶è€Œå·²ï¼Œä¸æ»¡æ„çš„è¯å¯ä»¥å°†ä»–æ”¹æˆ rotate 5 å§ï¼</span>
</pre></td></tr></tbody></table>

		<p>ç”±è¿™ä¸ªæ–‡ä»¶çš„é…ç½®æˆ‘ä»¬å¯ä»¥çŸ¥é“ /etc/logrotate.d å…¶å®å°±æ˜¯ç”± /etc/logrotate.conf
		æ‰€è§„åˆ’å‡ºæ¥çš„ç›®å½•ï¼Œæ‰€ä»¥ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰çš„æ•°æ®éƒ½ç»™ä»–å†™å…¥ /etc/logrotate.conf
		å³å¯ï¼Œä½†æ˜¯è¿™æ ·ä¸€æ¥è¿™ä¸ªæ–‡ä»¶å°±å®åœ¨æ˜¯å¤ªå¤æ‚äº†ï¼Œå°¤å…¶æ˜¯å½“æˆ‘ä»¬ä½¿ç”¨å¾ˆå¤šçš„æœåŠ¡åœ¨ç³»ç»Ÿä¸Šé¢æ—¶ï¼Œ
		æ¯ä¸ªæœåŠ¡éƒ½è¦å»ä¿®æ”¹ /etc/logrotate.conf çš„é…ç½®ä¹Ÿä¼¼ä¹ä¸å¤ªåˆç†ï½
		æ‰€ä»¥ï¼Œå¦‚æœç‹¬ç«‹å‡ºæ¥ä¸€ä¸ªç›®å½•ï¼Œé‚£ä¹ˆæ¯ä¸ªä»¥ RPM æ‰“åŒ…æ–¹å¼æ‰€åˆ›å»ºçš„æœåŠ¡çš„ç™»å½•æ–‡ä»¶è½®æ›¿é…ç½®ï¼Œ
		å°±å¯ä»¥ç‹¬è‡ªæˆä¸ºä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”æ”¾ç½®åˆ° /etc/logrotate.d/ å½“ä¸­å³å¯ï¼ŒçœŸæ˜¯æ–¹ä¾¿åˆåˆç†çš„åšæ³•å•Šï¼ ^_^</p>

		<p>ä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ª /etc/logrotate.conf æ˜¯ã€é»˜è®¤çš„è½®æ›¿çŠ¶æ€ã€è€Œå·²ï¼Œ
		æˆ‘ä»¬çš„å„ä¸ªæœåŠ¡éƒ½å¯ä»¥æ‹¥æœ‰è‡ªå·±çš„ç™»å½•æ–‡ä»¶è½®æ›¿é…ç½®ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªè¡Œä¿®æ”¹æˆè‡ªå·±å–œæ¬¢çš„æ ·å¼å•Šï¼
		ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„ç³»ç»Ÿçš„ç©ºé—´å¤Ÿå¤§ï¼Œå¹¶ä¸”æ‹…å¿ƒé™¤é”™ä»¥åŠé»‘å®¢çš„é—®é¢˜ï¼Œé‚£ä¹ˆå¯ä»¥ï¼š</p>

		<ul class="text_import2">
		<li>å°† rotate 4 æ”¹æˆ rotate 9 å·¦å³ï¼Œä»¥ä¿å­˜è¾ƒå¤šçš„å¤‡ä»½æ–‡ä»¶ï¼›</li>
		<li>å¤§éƒ¨åˆ†çš„ç™»å½•æ–‡ä»¶ä¸éœ€è¦ compress ç½—ï¼ä½†æ˜¯ç©ºé—´å¤ªå°å°±éœ€è¦ compress ï¼å°¤å…¶æ˜¯å¾ˆå ç£ç›˜ç©ºé—´çš„ httpd æ›´éœ€è¦ compress çš„ï¼</li>
		</ul>

		<p>å¥½äº†ï¼Œä¸Šé¢æˆ‘ä»¬å¤§è‡´ä»‹ç»äº† /var/log/wtmp è¿™ä¸ªæ–‡ä»¶çš„é…ç½®ï¼Œç°åœ¨ä½ çŸ¥é“äº† logrotate.conf çš„é…ç½®è¯­æ³•æ˜¯ï¼š</p>

<table class="term"><tbody><tr><td class="term"><pre>ç™»å½•æ–‡ä»¶çš„ç»å¯¹è·¯å¾„æ¡£å ... {
	ä¸ªåˆ«çš„å‚æ•°é…ç½®å€¼ï¼Œå¦‚ monthly, compress ç­‰ç­‰
}
</pre></td></tr></tbody></table>

		<p>åº•ä¸‹æˆ‘ä»¬å†ä»¥ /etc/logrotate.d/syslog è¿™ä¸ªè½®æ›¿ syslog æœåŠ¡çš„æ–‡ä»¶ï¼Œæ¥çœ‹çœ‹è¯¥å¦‚ä½•é…ç½®ä»–çš„ rotate å‘¢ï¼Ÿ</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">vi /etc/logrotate.d/syslog</span>
/var/log/messages /var/log/secure /var/log/maillog /var/log/spooler \
/var/log/boot.log /var/log/cron {
  <u>sharedscripts</u>
  <u>postrotate</u>
    /bin/kill -HUP `cat /var/run/syslogd.pid 2&gt; /dev/null` 2&gt; /dev/null || true
    /bin/kill -HUP `cat /var/run/rsyslogd.pid 2&gt; /dev/null` 2&gt; /dev/null || true
  <u>endscript</u>
}
</pre></td></tr></tbody></table>

		<p>åœ¨ä¸Šé¢çš„è¯­æ³•å½“ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“æ­£ç¡®çš„ logrotate çš„å†™æ³•ä¸ºï¼š</p>
		<ul>
		<li><span class="text_import2">æ¡£å</span>ï¼šè¢«å¤„ç†çš„ç™»å½•æ–‡ä»¶ç»å¯¹è·¯å¾„æ¡£åå†™åœ¨å‰é¢ï¼Œå¯ä»¥ä½¿ç”¨ç©ºç™½å­—èŠ‚åˆ†éš”å¤šä¸ªç™»å½•æ–‡ä»¶ï¼›</li>
		<li><span class="text_import2">å‚æ•°</span>ï¼šä¸Šè¿°æ¡£åè¿›è¡Œè½®æ›¿çš„å‚æ•°ä½¿ç”¨ { } åŒ…æ‹¬èµ·æ¥ï¼›</li>
		<li><span class="text_import2">è¿è¡Œè„šæœ¬</span>ï¼šå¯å‘¼å«å¤–éƒ¨å‘½ä»¤æ¥è¿›è¡Œé¢å¤–çš„å‘½ä»¤ä¸‹è¾¾ï¼Œè¿™ä¸ªé…ç½®éœ€ä¸ 
			sharedscripts .... endscript é…ç½®åˆç”¨æ‰è¡Œã€‚è‡³æ–¼å¯ç”¨çš„ç¯å¢ƒä¸ºï¼š<br>
			<ul>
			<li><span class="text_import2">prerotate</span>ï¼šåœ¨å¯åŠ¨ logrotate 
			ä¹‹å‰è¿›è¡Œçš„å‘½ä»¤ï¼Œä¾‹å¦‚ä¿®æ”¹ç™»å½•æ–‡ä»¶çš„å±æ€§ç­‰åŠ¨ä½œï¼›</li>
			<li><span class="text_import2">postrotate</span>ï¼šåœ¨åšå®Œ logrotate ä¹‹åå¯åŠ¨çš„å‘½ä»¤ï¼Œä¾‹å¦‚é‡æ–°å¯åŠ¨
				(kill -HUP) æŸä¸ªæœåŠ¡ï¼</li>
			<li>Prerotate ä¸ postrotate å¯¹æ–¼å·²åŠ ä¸Šç‰¹æ®Šå±æ€§çš„æ–‡ä»¶å¤„ç†ä¸Šé¢ï¼Œæ˜¯ç›¸å½“é‡è¦çš„è¿è¡Œç¨‹åºï¼</li>
			</ul></li>
		</ul>

		<p>é‚£ä¹ˆ /etc/logrotate.d/syslog å†…é…ç½®çš„å…­ä¸ªæ–‡ä»¶çš„è½®æ›¿åŠŸèƒ½å°±å˜æˆäº†ï¼š</p>

		<ul>
		<li>è¯¥é…ç½®åªå¯¹ /var/log/ å†…çš„ messages, secure, maillog, spooler, boot.log, cron æœ‰æ•ˆï¼›</li>
		<li>ç™»å½•æ–‡ä»¶è½®æ›¿æ¯å‘¨ä¸€æ¬¡ã€ä¿ç•™å››ä¸ªã€ä¸”è½®æ›¿ä¸‹æ¥çš„ç™»å½•æ–‡ä»¶ä¸è¿›è¡Œå‹ç¼©(æœªæ›´æ”¹é»˜è®¤å€¼)ï¼›</li>
		<li>è½®æ›¿å®Œæ¯•å (postrotate) å–å¾— syslog çš„ PID åï¼Œä»¥ kill -HUP é‡æ–°å¯åŠ¨ syslogd </li>
		</ul>

		<p>å‡è®¾æˆ‘ä»¬æœ‰é’ˆå¯¹ /var/log/messages è¿™ä¸ªæ–‡ä»¶æ·»åŠ  chattr +a çš„å±æ€§æ—¶ï¼Œ
		ä¾æ® logrotate çš„å·¥ä½œåŸç†ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œè¿™ä¸ª /var/log/messages å°†ä¼šè¢«æ›´åæˆä¸º 
		/var/log/messages.1 æ‰æ˜¯ã€‚ä½†æ˜¯ç”±æ–¼åŠ ä¸Šè¿™ä¸ª +a çš„å‚æ•°å•Šï¼Œæ‰€ä»¥æ›´åæ˜¯ä¸å¯èƒ½æˆåŠŸçš„ï¼
		é‚£æ€ä¹ˆåŠå‘¢ï¼Ÿå‘µå‘µï¼å°±åˆ©ç”¨ prerotate ä¸ postrotate æ¥è¿›è¡Œç™»å½•æ–‡ä»¶è½®æ›¿å‰ã€åæ‰€éœ€è¦ä½œçš„åŠ¨ä½œå•Šï¼
		æœçœŸå¦‚æ­¤æ—¶ï¼Œé‚£ä¹ˆä½ å¯ä»¥è¿™æ ·ä¿®æ”¹ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶å–”ï¼</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">vi /etc/logrotate.d/syslog</span>
/var/log/messages /var/log/secure /var/log/maillog /var/log/spooler \
/var/log/boot.log /var/log/cron {
  sharedscripts
  <span class="term_write">prerotate
    /usr/bin/chattr -a /var/log/messages
  endscript
  sharedscripts</span>
  postrotate
    /bin/kill -HUP `cat /var/run/syslogd.pid 2&gt; /dev/null` 2&gt; /dev/null || true
    /bin/kill -HUP `cat /var/run/rsyslogd.pid 2&gt; /dev/null` 2&gt; /dev/null || true
    <span class="term_write">/usr/bin/chattr +a /var/log/messages</span>
  endscript
}
</pre></td></tr></tbody></table>

		<p>çœ‹åˆ°å¦ï¼Ÿå°±æ˜¯å…ˆç»™ä»–å»æ‰ a è¿™ä¸ªå±æ€§ï¼Œè®©ç™»å½•æ–‡ä»¶ /var/log/messages å¯ä»¥è¿›è¡Œè½®æ›¿çš„åŠ¨ä½œï¼Œ
		ç„¶åè¿è¡Œäº†è½®æ›¿ä¹‹åï¼Œå†ç»™ä»–åŠ å…¥è¿™ä¸ªå±æ€§ï¼è¯·ç‰¹åˆ«ç•™æ„çš„æ˜¯ï¼Œé‚£ä¸ª
		/bin/kill -HUP ... çš„æ„ä¹‰ï¼Œè¿™ä¸€è¡Œçš„ç›®çš„åœ¨æ–¼å°†ç³»ç»Ÿçš„ syslogd
		é‡æ–°ä»¥å…¶å‚æ•°æ¡£ (syslog.conf) çš„æ•°æ®è¯»å…¥ä¸€æ¬¡ï¼ä¹Ÿå¯ä»¥æƒ³æˆæ˜¯ reload çš„æ„æ€å•¦ï¼
		ç”±æ–¼æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ç©ºçš„çºªå½•æ¡£ï¼Œå¦‚æœä¸è¿è¡Œæ­¤ä¸€è¡Œæ¥é‡æ–°å¯åŠ¨æœåŠ¡çš„è¯ï¼Œ
		é‚£ä¹ˆè®°å½•çš„æ—¶å€™å°†ä¼šå‘ç”Ÿé”™è¯¯å‘¦ï¼(è¯·å›åˆ°<a href="0440processcontrol.php.html">ç¬¬åä¸ƒç« </a>è¯»ä¸€ä¸‹
		kill åé¢çš„ signal çš„å†…å®¹è¯´æ˜)</p>
	</div>

	<hr><a name="rotate_command"></a><img src="../image/logo.png" alt="å°æ ‡é¢˜çš„å›¾ç¤º" width="24" align="middle" height="23"><span class="text_h2">å®é™…æµ‹è¯• logrotate çš„åŠ¨ä½œ</span><br>
	<div class="block2">
		<p>å¥½äº†ï¼Œé…ç½®å®Œæˆä¹‹åï¼Œæˆ‘ä»¬æ¥æµ‹è¯•çœ‹çœ‹è¿™æ ·çš„é…ç½®æ˜¯å¦å¯è¡Œå‘¢ï¼Ÿç»™ä»–è¿è¡Œåº•ä¸‹çš„å‘½ä»¤ï¼š</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">logrotate [-vf] logfile</span>
<span class="term_say">é€‰é¡¹ä¸å‚æ•°ï¼š
-v  ï¼šå¯åŠ¨æ˜¾ç¤ºæ¨¡å¼ï¼Œä¼šæ˜¾ç¤º logrotate è¿è¡Œçš„è¿‡ç¨‹å–”ï¼
-f  ï¼šä¸è®ºæ˜¯å¦ç¬¦åˆé…ç½®æ¡£çš„æ•°æ®ï¼Œå¼ºåˆ¶æ¯ä¸ªç™»å½•æ–‡ä»¶éƒ½è¿›è¡Œ rotate çš„åŠ¨ä½œï¼</span>

<span class="term_hd">èŒƒä¾‹ä¸€ï¼šè¿è¡Œä¸€æ¬¡ logrotate çœ‹çœ‹æ•´ä¸ªæµç¨‹ä¸ºä½•ï¼Ÿ</span>
[root@www ~]# <span class="term_command">logrotate -v /etc/logrotate.conf</span>
reading config file /etc/logrotate.conf <span class="term_note">&lt;==è¯»å–ä¸»è¦é…ç½®æ¡£</span>
including /etc/logrotate.d              <span class="term_note">&lt;==å‘¼å«å¤–éƒ¨çš„é…ç½®</span>
reading config file acpid               <span class="term_note">&lt;==å°±æ˜¯å¤–éƒ¨é…ç½®å•Šï¼</span>
<span class="term_say">....(ä¸­é—´çœç•¥)....</span>
Handling 21 logs                        <span class="term_note">&lt;==å…±æœ‰ 21 ä¸ªç™»å½•æ–‡ä»¶è¢«è®°å½•</span>
<span class="term_say">....(ä¸­é—´çœç•¥)....</span>
rotating pattern: /var/log/messages /var/log/secure /var/log/maillog \
/var/log/spooler /var/log/boot.log /var/log/cron  weekly (4 rotations)
empty log files are rotated, old logs are removed
considering log /var/log/messages       <span class="term_note">&lt;==å¼€å§‹å¤„ç† messages</span>
  log does not need rotating            <span class="term_note">&lt;==å› ä¸ºæ—¶é—´æœªåˆ°ï¼Œä¸éœ€è¦æ›´åŠ¨ï¼</span>
<span class="term_say">....(åº•ä¸‹çœç•¥)....</span>

<span class="term_hd">èŒƒä¾‹äºŒï¼šå¼ºåˆ¶è¿›è¡Œ logrotate çš„åŠ¨ä½œ</span>
[root@www ~]# <span class="term_command">logrotate -vf /etc/logrotate.conf</span>
<span class="term_say">....(å‰é¢çœç•¥)....</span>
<span style="font-size: 9pt;">rotating log /var/log/messages, log-&gt;rotateCount is 4
renaming /var/log/messages.4 to /var/log/messages.5 (rotatecount 4, logstart 1, i 4),
renaming /var/log/messages.3 to /var/log/messages.4 (rotatecount 4, logstart 1, i 3),
renaming /var/log/messages.2 to /var/log/messages.3 (rotatecount 4, logstart 1, i 2),
renaming /var/log/messages.1 to /var/log/messages.2 (rotatecount 4, logstart 1, i 1),
renaming /var/log/messages.0 to /var/log/messages.1 (rotatecount 4, logstart 1, i 0),
old log /var/log/messages.0 does not exist</span>
<span class="term_say">....(åº•ä¸‹çœç•¥)....</span>
<span class="term_say"># çœ‹åˆ°å¦ï¼Ÿæ•´ä¸ª rotate çš„åŠ¨ä½œå°±æ˜¯è¿™æ ·ä¸€æ­¥ä¸€æ­¥è¿›è¡Œçš„ï½</span>

[root@www ~]# <span class="term_command">ll /var/log/messages*; lsattr /var/log/messages</span>
-rw------- 1 root root    63 Apr  8 15:19 /var/log/messages
-rw------- 1 root root   670 Apr  8 14:22 /var/log/messages.1
-rw------- 1 root root 24984 Apr  1 19:26 /var/log/messages.2
-rw------- 1 root root  1911 Mar 28 11:32 /var/log/messages.3
-rw------- 1 root root 25193 Mar 22 04:02 /var/log/messages.4
-----a------- /var/log/messages <span class="term_note">&lt;==ä¸»åŠ¨åŠ å…¥ a çš„éšè—å±æ€§ç½—ï¼</span>
</pre></td></tr></tbody></table>

		<p>ä¸Šé¢é‚£ä¸ª -f å…·æœ‰ã€å¼ºåˆ¶è¿è¡Œã€çš„æ„æ€ï¼Œå¦‚æœä¸€åˆ‡çš„é…ç½®éƒ½æ²¡æœ‰é—®é¢˜çš„è¯ï¼Œé‚£ä¹ˆç†è®ºä¸Šï¼Œä½ çš„
		/var/log è¿™ä¸ªç›®å½•å°±ä¼šèµ·å˜åŒ–ç½—ï¼è€Œä¸”åº”è¯¥ä¸ä¼šå‡ºç°é”™è¯¯ä¿¡æ¯æ‰å¯¹ï¼å˜¿å˜¿ï¼è¿™æ ·å°±
		OK äº†ï¼å¾ˆæ£’ä¸æ˜¯å—ï¼Ÿï¼</p>

		<p>ç”±æ–¼ logrotate çš„å·¥ä½œå·²ç»åŠ å…¥ crontab é‡Œå¤´äº†ï¼æ‰€ä»¥ç°åœ¨æ¯å¤©ç³»ç»Ÿéƒ½ä¼šè‡ªåŠ¨çš„ç»™ä»–æŸ¥çœ‹
		logrotate ç½—ï¼ä¸ç”¨æ‹…å¿ƒçš„å•¦ï¼åªæ˜¯è¦æ³¨æ„ä¸€ä¸‹é‚£ä¸ª /var/log/messages é‡Œå¤´æ˜¯å¦å¸¸å¸¸æœ‰ç±»ä¼¼åº•ä¸‹çš„å­—çœ¼ï¼š</p>
		<blockquote class="text_import2" style="font-family: 'ç»†æ˜ä½“';">
		Apr  8 15:19:47 www syslogd 1.4.1: restart (remote reception).</blockquote>

		<p>è¿™è¯´æ˜çš„æ˜¯ syslogd é‡æ–°å¯åŠ¨çš„æ—¶é—´å•¦ (å°±æ˜¯å› ä¸º /etc/logrotate.d/syslog çš„é…ç½®ä¹‹ç¼˜æ•…ï¼)
		åº•ä¸‹æˆ‘ä»¬æ¥è¿›è¡Œä¸€äº›ä¾‹é¢˜çš„ç»ƒä¹ ï¼Œè®©ä½ æ›´è¯¦ç»†çš„äº†è§£ logrotate çš„åŠŸç”¨å•Šï¼</p>
	</div>

	<hr><a name="rotate_user"></a><img src="../image/logo.png" alt="å°æ ‡é¢˜çš„å›¾ç¤º" width="24" align="middle" height="23"><span class="text_h2">è‡ªè®¢ç™»å½•æ–‡ä»¶çš„è½®æ›¿åŠŸèƒ½</span><br>
	<div class="block2">
		<p>å‡è®¾å‰ææ˜¯è¿™æ ·çš„ï¼Œå‰ä¸€å°èŠ‚å½“ä¸­ï¼Œå‡è®¾ä½ å·²ç»åˆ›å»ºäº† /var/log/admin.log è¿™ä¸ªæ–‡ä»¶ï¼Œ
		ç°åœ¨ï¼Œä½ æƒ³è¦å°†è¯¥æ–‡ä»¶åŠ ä¸Š +a è¿™ä¸ªéšè—æ ‡ç­¾ï¼Œè€Œä¸”é…ç½®åº•ä¸‹çš„ç›¸å…³èµ„è®¯ï¼š</p>

		<ul>
		<li>ç™»å½•æ–‡ä»¶è½®æ›¿ä¸€ä¸ªæœˆè¿›è¡Œä¸€æ¬¡ï¼›</li>
		<li>è¯¥ç™»å½•æ–‡ä»¶è‹¥å¤§æ–¼ 10MB æ—¶ï¼Œåˆ™ä¸»åŠ¨è¿›è¡Œè½®æ›¿ï¼Œä¸éœ€è¦è€ƒè™‘ä¸€ä¸ªæœˆçš„æœŸé™ï¼›</li>
		<li>ä¿å­˜äº”ä¸ªå¤‡ä»½æ–‡ä»¶ï¼›</li>
		<li>å¤‡ä»½æ–‡ä»¶éœ€è¦å‹ç¼©</li>
		</ul>

		<p>é‚£ä½ å¯ä»¥æ€ä¹ˆæ ·é…ç½®å‘¢ï¼Ÿå‘µå‘µï½å¾ˆç®€å•å•Šï¼çœ‹çœ‹åº•ä¸‹çš„åŠ¨ä½œå§ï¼</p>

<table class="term"><tbody><tr><td class="term"><pre><span class="term_hd"># 1. å…ˆåˆ›å»º +a è¿™ä¸ªå±æ€§å•Šï¼</span>
[root@www ~]# <span class="term_command">chattr +a /var/log/admin.log</span>
[root@www ~]# <span class="term_command">lsattr /var/log/admin.log</span>
-----a------- /var/log/admin.log
[root@www ~]# <span class="term_command">mv /var/log/admin.log /var/log/admin.log.1</span>
mv: cannot move `/var/log/admin.log' to `/var/log/admin.log.1': 
Operation not permitted
<span class="term_say"># è¿™é‡Œç¡®å®šäº†åŠ å…¥ a çš„éšè—å±æ€§ï¼æ‰€ä»¥ root æ— æ³•ç§»åŠ¨æ­¤ç™»å½•æ–‡ä»¶ï¼</span>

<span class="term_hd"># 2. å¼€å§‹åˆ›å»º logrotate çš„é…ç½®æ¡£ï¼Œæ·»åŠ ä¸€ä¸ªæ–‡ä»¶åœ¨ /etc/logrotate.d å†…å°±å¯¹äº†ï¼</span>
[root@www ~]# <span class="term_command">vi /etc/logrotate.d/admin</span>
<span class="term_write"># This configuration is from VBird 2009/04/08
/var/log/admin.log {
        monthly   <span class="term_note">&lt;==æ¯ä¸ªæœˆè¿›è¡Œä¸€æ¬¡</span>
        size=10M  <span class="term_note">&lt;==æ–‡ä»¶å®¹é‡å¤§æ–¼ 10M åˆ™å¼€å§‹å¤„ç½®</span>
        rotate 5  <span class="term_note">&lt;==ä¿ç•™äº”ä¸ªï¼</span>
        compress  <span class="term_note">&lt;==è¿›è¡Œå‹ç¼©å·¥ä½œï¼</span>
        sharedscripts
        prerotate
                /usr/bin/chattr -a /var/log/admin.log
        endscript
        sharedscripts
        postrotate
                /usr/bin/killall -HUP syslogd
                /usr/bin/chattr +a /var/log/admin.log
        endscript
}</span>

<span class="term_hd"># 3. æµ‹è¯•ä¸€ä¸‹ logrotate ç›¸å…³åŠŸèƒ½çš„èµ„è®¯æ˜¾ç¤ºï¼š</span>
[root@www ~]# <span class="term_command">logrotate -v /etc/logrotate.conf</span>
<span class="term_say">....(å‰é¢çœç•¥)....</span>
rotating pattern: /var/log/admin.log  10485760 bytes (5 rotations)
empty log files are rotated, old logs are removed
considering log /var/log/admin.log
  log does not need rotating
not running prerotate script, since no logs will be rotated
not running postrotate script, since no logs were rotated
<span class="term_say">....(åº•ä¸‹çœç•¥)....
# å› ä¸ºè¿˜ä¸è¶³ä¸€ä¸ªæœˆï¼Œæ–‡ä»¶ä¹Ÿæ²¡æœ‰å¤§æ–¼ 10Mï¼Œæ‰€ä»¥ä¸éœ€è¿›è¡Œè½®æ›¿ï¼</span>

<span class="term_hd"># 4. æµ‹è¯•ä¸€ä¸‹å¼ºåˆ¶ logrotate ä¸ç›¸å…³åŠŸèƒ½çš„èµ„è®¯æ˜¾ç¤ºï¼š</span>
[root@www ~]# <span class="term_command">logrotate -vf /etc/logrotate.d/admin</span>
<span style="font-size: 9pt;">reading config file /etc/logrotate.d/admin
reading config info for /var/log/admin.log

Handling 1 logs

rotating pattern: /var/log/admin.log  forced from command line (5 rotations)
empty log files are rotated, old logs are removed
considering log /var/log/admin.log
  log needs rotating
rotating log /var/log/admin.log, log-&gt;rotateCount is 5
renaming /var/log/admin.log.5.gz to /var/log/admin.log.6.gz (rotatecount 5, logstart 1, i 5),
old log /var/log/admin.log.5.gz does not exist
renaming /var/log/admin.log.4.gz to /var/log/admin.log.5.gz (rotatecount 5, logstart 1, i 4),
old log /var/log/admin.log.4.gz does not exist
renaming /var/log/admin.log.3.gz to /var/log/admin.log.4.gz (rotatecount 5, logstart 1, i 3),
old log /var/log/admin.log.3.gz does not exist
renaming /var/log/admin.log.2.gz to /var/log/admin.log.3.gz (rotatecount 5, logstart 1, i 2),
old log /var/log/admin.log.2.gz does not exist
renaming /var/log/admin.log.1.gz to /var/log/admin.log.2.gz (rotatecount 5, logstart 1, i 1),
old log /var/log/admin.log.1.gz does not exist
renaming /var/log/admin.log.0.gz to /var/log/admin.log.1.gz (rotatecount 5, logstart 1, i 0),
old log /var/log/admin.log.0.gz does not exist
log /var/log/admin.log.6.gz doesn't exist -- won't try to dispose of it
running prerotate script
renaming /var/log/admin.log to /var/log/admin.log.1
running postrotate script
compressing log with: /bin/gzip</span>


[root@www ~]# <span class="term_command">lsattr /var/log/admin.log*</span>
-----a------- /var/log/admin.log
------------- /var/log/admin.log.1.gz  <span class="term_note">&lt;==æœ‰å‹ç¼©è¿‡å–”ï¼</span>
</pre></td></tr></tbody></table>

		<p>çœ‹åˆ°äº†å—ï¼Ÿé€è¿‡è¿™ä¸ªæ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºèµ·å±æ–¼è‡ªå·±çš„ logrotate é…ç½®æ–‡ä»¶ï¼Œ
		å¾ˆç®€ä¾¿å§ï¼å°¤å…¶æ˜¯è¦æ³¨æ„çš„ï¼Œ /etc/syslog.conf ä¸ /etc/logrotate.d/* 
		æ–‡ä»¶å¸¸å¸¸è¦æ­é…èµ·æ¥ï¼Œä¾‹å¦‚åˆšåˆšæˆ‘ä»¬æåˆ°çš„ä¸¤ä¸ªæ¡ˆä¾‹ä¸­æ‰€åˆ›å»ºçš„ /var/log/admin.log
		å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï½åˆ›å»ºåï¼Œè¿˜è¦ä½¿ç”¨ logrotate æ¥è½®æ›¿å•Šï¼ ^_^</p>
	</div>
</div>
<hr />
    </td>
    <td style="width: 16px; font-size: 6px;">ã€€</td></tr>
<tr><td style="width: 16px; height: 16px;">ã€€</td>
    <td style="width: 866px; height: 16px;">ã€€</td>
    <td style="width: 16px; height: 16px;">ã€€</td></tr>
</tbody></table>

<div style="padding-top: 0px; text-align: center;">
<span style="font-size: 80%;">
	<a href="http://vbird.dic.ksu.edu.tw/" target="_top" title="å‰å¾€é¸Ÿå“¥çš„é¦–é¡µ">http://linux.vbird.org</a>
	is designed by <a href="mailto:vbird@mail.vbird.idv.tw" title="è”ç»œé¸Ÿå“¥(æˆ‘ä¸è¦å¹¿å‘Šä¿¡ï¼)">VBird</a>
		during 2001-2011. <a href="http://www.ksu.edu.tw/" target="_blank">ksu.edu</a></span>
         ï»¿<div id="apDiv4">
      <p>æœ¬ç½‘é¡µä¸»è¦ä»¥Firefoxé…åˆè§£æåº¦ 1024x768 ä½œä¸ºè®¾è®¡ä¾æ®&nbsp;&nbsp;&nbsp;&nbsp; é¸Ÿå“¥è‡ªç”±è½¯ä»¶æ•´åˆåº”ç”¨ç ”ç©¶å®¤</p></div></div>
</div>
</center>
</body></html>
